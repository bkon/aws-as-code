#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "aws_as_code"
require "thor"
require "cfndsl"

# Main CLI application for aws-as-code gem
class AwsAsCodeCli < Thor
  desc "compile", "compile cfndsl to CF JSON"
  option :input_dir
  option :output_dir
  def compile
    AwsAsCode::Task::Compile.new(config).execute
  end

  private

  def config
    @config ||= init_config
  end

  def init_config
    AwsAsCode::Config
      .new input_directory: options[:input_dir],
           output_directory: options[:output_dir]
  end
end

AwsAsCodeCli.start(ARGV)
